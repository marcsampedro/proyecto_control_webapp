{% extends "base.html" %}
{% block content %}
<!-- TARJETAS RESUMEN (5 columnas, diseÃ±o mejorado) -->
<style>
  .metric-card {
    transition: all 0.2s ease-in-out;
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    background: #fff;
  }
  .metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  .metric-label {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 500;
  }
  .metric-value {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
  }
  .metric-positive { color: #198754; }
  .metric-negative { color: #dc3545; }
  .metric-neutral { color: #212529; }
</style>

<div class="mb-4 text-end">
  <a href="{{ url_for('generar_informe_pdf', desde=desde, hasta=hasta) }}"
     class="btn btn-outline-danger" target="_blank">
    ðŸ§¾ Generar Informe PDF
  </a>
</div>


<div class="row g-3 mb-4 row-cols-1 row-cols-md-5 text-center">

  <!-- 1ï¸âƒ£ Total Forecast -->
  <div class="col">
    <div class="metric-card p-3 h-100 border">
      <div class="metric-label">Total Forecast</div>
      <p class="metric-value metric-neutral">
        {{ total_forecast|euro|safe }}
      </p>
    </div>
  </div>

  <!-- 2ï¸âƒ£ Total Facturado -->
  <div class="col">
    <div class="metric-card p-3 h-100 border">
      <div class="metric-label">Total Facturado</div>
      <p class="metric-value metric-neutral">
        {{ total_facturado|euro|safe }}
      </p>
    </div>
  </div>

  <!-- 3ï¸âƒ£ WIP -->
  <div class="col">
    <div class="metric-card p-3 h-100 border">
      <div class="metric-label">WIP (Forecast - Facturado)</div>
      {% set wip_color = 'metric-positive' if (wip or 0) > 0 else 'metric-negative' if (wip or 0) < 0 else 'metric-neutral' %}
      <p class="metric-value {{ wip_color }}">
        {{ wip|euro|safe }}
      </p>
    </div>
  </div>

  <!-- 4ï¸âƒ£ Pendiente -->
  <div class="col">
    <div class="metric-card p-3 h-100 border">
      <div class="metric-label">Pendiente (incurrir + fra.)</div>
      <p class="metric-value metric-neutral">
        {{ total_pendiente|euro|safe }}
      </p>
    </div>
  </div>

  <!-- 5ï¸âƒ£ WIP Calculado -->
<div class="col">
  <div class="metric-card p-3 h-100 border">
    <div class="card-body text-center">
      <small class="text-muted">WIP + Prepagado</small>
      <p class="metric-value metric-neutral">
        <span >{{wip_calculado}}</span>
      </p>
      <small class="text-muted">Inc. {{ total_general_prepagado|euro|safe }} de Prep.</small>
    </div>
  </div>
</div>

</div>


<form method="get" class="row g-3 align-items-end mb-4">
  <div class="col-auto">
    <label for="desde" class="form-label mb-0">Desde</label>
    <input type="month" id="desde" name="desde" class="form-control" value="{{ desde }}">
  </div>
  <div class="col-auto">
    <label for="hasta" class="form-label mb-0">Hasta</label>
    <input type="month" id="hasta" name="hasta" class="form-control" value="{{ hasta }}">
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary">Filtrar</button>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">Reset</a>
  </div>
</form>
<div class="card shadow-sm mb-4"><div class="card-body"><h5 class="card-title">Serie Mensual</h5><canvas id="serieChart" height="120"></canvas></div></div>
<div class="card shadow-sm"><div class="card-body"><h5 class="card-title">EvoluciÃ³n de la bolsa mensual</h5><canvas id="evoChart" height="120"></canvas></div></div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const serie = {{ serie|tojson }};
    const evo = {{ evo_serie|tojson }};
    renderDashboardCharts(serie, evo);
  });
</script>

{% endblock %}
